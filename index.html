<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nano Company - Sign Up</title>
  <meta name="description" content="Join Nano Company - Create your account today" />

  <!-- Icons & Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Clash+Display:wght@400;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <!-- reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <style>
    /* (styles unchanged except small responsive tweaks) */
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',system-ui,Segoe UI,Roboto,sans-serif}
    :root{--primary-color:#000;--text-color:#fff;--glass-bg:rgba(255,255,255,0.06);--glass-border:rgba(255,255,255,0.12);--accent:#4285F4}
    body{min-height:100vh;background:linear-gradient(135deg,#000,#16213e);color:var(--text-color);display:flex;align-items:center;justify-content:center;padding:20px}
    .main-container{max-width:1200px;display:flex;gap:40px;align-items:center;width:100%}
    .hero-title{font-family:'Plus Jakarta Sans',sans-serif;font-size:80px;line-height:1;color:transparent;-webkit-background-clip:text;background-clip:text}
    .signup-container{width:100%;max-width:480px;background:var(--glass-bg);border-radius:16px;padding:0;backdrop-filter:blur(12px);border:1px solid var(--glass-border);box-shadow:0 8px 30px rgba(0,0,0,0.4)}
    .signup-header{padding:28px;text-align:center;border-bottom:1px solid var(--glass-border)}
    .signup-header h1{font-size:22px}
    .signup-form{padding:24px}
    .form-row{display:flex;gap:12px}
    .form-group{flex:1}
    label{display:block;margin-bottom:8px;font-weight:600;font-size:14px}
    .form-control{width:100%;padding:12px;border-radius:8px;border:1px solid var(--glass-border);background:rgba(255,255,255,0.02);color:var(--text-color)}
    .toggle-password{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;color:rgba(255,255,255,0.7);cursor:pointer}
    .password-container{position:relative}
    .signup-button{width:100%;padding:14px;border-radius:10px;border:none;background:rgba(255,255,255,0.08);color:#fff;font-weight:700;cursor:pointer}
    .signup-button:disabled{opacity:0.6;cursor:not-allowed}
    .error-message{color:#ff6b6b;font-size:13px;margin-top:6px;display:none}
    .email-status{display:none;padding:10px;border-radius:8px;margin-top:10px;text-align:center}
    .strength-meter{height:6px;background:rgba(255,255,255,0.08);border-radius:6px;overflow:hidden}
    .strength-meter-fill{height:100%;width:0;transition:width .25s}
    .google-signup{display:flex;align-items:center;justify-content:center;padding:12px;border-radius:10px;border:1px solid var(--glass-border);width:100%;background:transparent;cursor:pointer}
    .divider{display:flex;align-items:center;gap:12px;color:rgba(255,255,255,0.6);font-size:13px;margin:18px 0}
    .divider::before,.divider::after{content:'';flex:1;border-bottom:1px solid var(--glass-border)}
    @media(max-width:1024px){.main-container{flex-direction:column}.hero-title{font-size:56px;text-align:center}}
  </style>
</head>
<body>
  <div class="main-container">
    <div class="hero-section">
      <h1 class="hero-title">Get<br/>Ready<br/>with<br/>nano<br/>Company</h1>
    </div>

    <div class="signup-container">
      <div class="signup-header">
        <h1>Create Account</h1>
        <p style="opacity:.85">Join our community today</p>
      </div>

      <form class="signup-form" id="signupForm" novalidate>
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">First Name</label>
            <input type="text" id="firstName" class="form-control" placeholder="Enter your first name" required />
            <div class="error-message" id="firstNameError">First name must be at least 2 characters</div>
          </div>

          <div class="form-group">
            <label for="lastName">Last Name</label>
            <input type="text" id="lastName" class="form-control" placeholder="Enter your last name" required />
            <div class="error-message" id="lastNameError">Last name must be at least 2 characters</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <label for="email">Email Address</label>
          <input type="email" id="email" class="form-control" placeholder="Enter your email" required />
          <div class="error-message" id="emailError">Please enter a valid email address</div>
        </div>

        <div style="margin-top:14px">
          <label for="password">Password</label>
          <div class="password-container">
            <input type="password" id="password" class="form-control" placeholder="Create a password (min 9 characters)" required />
            <button type="button" class="toggle-password" id="togglePassword" aria-label="Toggle password visibility"><i class="far fa-eye"></i></button>
          </div>
          <div class="strength-meter"><div class="strength-meter-fill" id="strengthMeter"></div></div>
          <div class="error-message" id="passwordError">Password must be at least 9 characters with uppercase, lowercase, and numbers</div>
        </div>

        <div style="margin-top:14px">
          <label for="confirmPassword">Confirm Password</label>
          <div class="password-container">
            <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm your password" required />
            <button type="button" class="toggle-password" id="toggleConfirmPassword" aria-label="Toggle password visibility"><i class="far fa-eye"></i></button>
          </div>
          <div class="error-message" id="confirmPasswordError">Passwords do not match</div>
        </div>

        <!-- reCAPTCHA -->
        <div style="margin-top:18px;display:flex;justify-content:center">
          <div class="g-recaptcha" data-sitekey="REPLACE_WITH_YOUR_RECAPTCHA_SITEKEY" data-callback="onRecaptchaSuccess" data-expired-callback="onRecaptchaExpired"></div>
        </div>
        <div class="error-message" id="recaptchaError">Please complete the reCAPTCHA verification</div>

        <div style="margin-top:14px;display:flex;align-items:center;gap:8px">
          <input type="checkbox" id="terms" />
          <label for="terms">I agree to the <a href="#" id="termsLink">Terms</a> and <a href="#" id="privacyLink">Privacy Policy</a></label>
        </div>
        <div class="error-message" id="termsError">You must agree to the terms and conditions</div>

        <div style="margin-top:18px">
          <button type="submit" class="signup-button" id="signupButton" disabled><span id="signupButtonText">Create Account</span></button>
        </div>

        <div class="email-status" id="emailStatus"></div>

        <div class="verification-section" id="verificationSection" style="display:none;margin-top:12px;padding:14px;background:rgba(255,255,255,0.02);border-radius:8px">
          <h3 style="margin-bottom:6px">Email Verification</h3>
          <p>We've sent a verification email to <span id="verificationEmail"></span></p>
          <p>Please check your inbox and click the verification link to complete your registration.</p>
          <div style="margin-top:10px">Didn't receive the email? <a href="#" id="resendEmail">Resend Verification Email</a></div>
        </div>

        <div class="divider" style="margin-top:18px"><span>Or continue with</span></div>

        <div style="margin-top:12px">
          <button type="button" class="google-signup" id="googleSignUp"><span style="margin-right:8px"><i class="fab fa-google"></i></span>Sign up with Google</button>
        </div>

        <div style="margin-top:12px;text-align:center;font-size:13px;opacity:.85">Already have an account? <a href="index.html">Sign in</a></div>
      </form>
    </div>
  </div>

  <script>
    // ========== IMPORTANT: Replace the placeholders below with your actual Firebase / reCAPTCHA values ==========
    const firebaseConfig = {
      apiKey: "REPLACE_WITH_YOUR_API_KEY",
      authDomain: "REPLACE_WITH_YOUR_PROJECT.firebaseapp.com",
      projectId: "REPLACE_WITH_YOUR_PROJECT",
      storageBucket: "REPLACE_WITH_YOUR_PROJECT.appspot.com",
      messagingSenderId: "REPLACE_WITH_MESSAGING_SENDER_ID",
      appId: "REPLACE_WITH_APP_ID",
      measurementId: "REPLACE_WITH_MEASUREMENT_ID"
    };

    // Initialize Firebase safely
    try {
      firebase.initializeApp(firebaseConfig);
      console.log('Firebase initialized');
    } catch (err) {
      console.error('Firebase init error:', err);
    }

    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM
    const signupForm = document.getElementById('signupForm');
    const firstNameInput = document.getElementById('firstName');
    const lastNameInput = document.getElementById('lastName');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const termsCheckbox = document.getElementById('terms');
    const togglePassword = document.getElementById('togglePassword');
    const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
    const strengthMeter = document.getElementById('strengthMeter');
    const signupButton = document.getElementById('signupButton');
    const signupButtonText = document.getElementById('signupButtonText');
    const emailStatus = document.getElementById('emailStatus');
    const verificationSection = document.getElementById('verificationSection');
    const verificationEmail = document.getElementById('verificationEmail');
    const resendEmail = document.getElementById('resendEmail');

    const firstNameError = document.getElementById('firstNameError');
    const lastNameError = document.getElementById('lastNameError');
    const emailError = document.getElementById('emailError');
    const passwordError = document.getElementById('passwordError');
    const confirmPasswordError = document.getElementById('confirmPasswordError');
    const termsError = document.getElementById('termsError');
    const recaptchaError = document.getElementById('recaptchaError');

    let isSubmitting = false;
    let isRecaptchaVerified = false;

    // Utility to enable/disable signup button based on recaptcha & submission state
    function updateSignupButtonState() {
      // Enable only when reCAPTCHA is verified and not currently submitting
      signupButton.disabled = !(isRecaptchaVerified && !isSubmitting);
    }

    // reCAPTCHA callbacks (set on window so grecaptcha can call them)
    window.onRecaptchaSuccess = function(token) {
      console.log('reCAPTCHA success, token:', token);
      isRecaptchaVerified = true;
      recaptchaError.style.display = 'none';
      updateSignupButtonState();
    };

    window.onRecaptchaExpired = function() {
      console.log('reCAPTCHA expired');
      isRecaptchaVerified = false;
      recaptchaError.style.display = 'block';
      updateSignupButtonState();
    };

    // Toggle password visibility
    togglePassword.addEventListener('click', function() {
      const type = passwordInput.type === 'password' ? 'text' : 'password';
      passwordInput.type = type;
      this.innerHTML = type === 'password' ? '<i class="far fa-eye"></i>' : '<i class="far fa-eye-slash"></i>';
    });
    toggleConfirmPassword.addEventListener('click', function() {
      const type = confirmPasswordInput.type === 'password' ? 'text' : 'password';
      confirmPasswordInput.type = type;
      this.innerHTML = type === 'password' ? '<i class="far fa-eye"></i>' : '<i class="far fa-eye-slash"></i>';
    });

    // Password strength
    passwordInput.addEventListener('input', function() {
      const pw = this.value;
      let score = 0;
      if (pw.length >= 9) score += 25;
      if (/[a-z]/.test(pw)) score += 25;
      if (/[A-Z]/.test(pw)) score += 25;
      if (/[0-9]/.test(pw)) score += 25;
      strengthMeter.style.width = score + '%';

      if (score < 50) strengthMeter.style.backgroundColor = '#d32f2f';
      else if (score < 75) strengthMeter.style.backgroundColor = '#ff9800';
      else strengthMeter.style.backgroundColor = '#4caf50';

      if (pw.length >= 9 && /[a-z]/.test(pw) && /[A-Z]/.test(pw) && /[0-9]/.test(pw)) {
        hideError(passwordInput, passwordError);
      } else if (pw.length > 0) {
        showError(passwordInput, passwordError);
      } else hideError(passwordInput, passwordError);
    });

    // Helper UI functions
    function showError(inputOrElem, errorElem) {
      if (errorElem) errorElem.style.display = 'block';
      try { inputOrElem.classList && inputOrElem.classList.add('error'); } catch (e){}
    }
    function hideError(inputOrElem, errorElem) {
      if (errorElem) errorElem.style.display = 'none';
      try { inputOrElem.classList && inputOrElem.classList.remove('error'); } catch (e){}
    }

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function showEmailStatus(message, type) {
      emailStatus.textContent = message;
      emailStatus.className = 'email-status ' + type;
      emailStatus.style.display = 'block';
      if (type === 'success') setTimeout(() => (emailStatus.style.display = 'none'), 5000);
    }

    // Form submit
    signupForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      if (isSubmitting) return;

      let valid = true;
      const firstName = firstNameInput.value.trim();
      const lastName = lastNameInput.value.trim();
      const email = emailInput.value.trim();
      const password = passwordInput.value;

      if (firstName.length < 2) { showError(firstNameInput, firstNameError); valid = false; } else hideError(firstNameInput, firstNameError);
      if (lastName.length < 2) { showError(lastNameInput, lastNameError); valid = false; } else hideError(lastNameInput, lastNameError);
      if (!validateEmail(email)) { showError(emailInput, emailError); valid = false; } else hideError(emailInput, emailError);
      if (password.length < 9 || !/[a-z]/.test(password) || !/[A-Z]/.test(password) || !/[0-9]/.test(password)) { showError(passwordInput, passwordError); valid = false; } else hideError(passwordInput, passwordError);
      if (password !== confirmPasswordInput.value) { showError(confirmPasswordInput, confirmPasswordError); valid = false; } else hideError(confirmPasswordInput, confirmPasswordError);

      if (!isRecaptchaVerified) { recaptchaError.style.display = 'block'; valid = false; } else recaptchaError.style.display = 'none';
      if (!termsCheckbox.checked) { termsError.style.display = 'block'; valid = false; } else termsError.style.display = 'none';

      if (!valid) {
        signupForm.style.animation = 'shake .5s';
        setTimeout(() => (signupForm.style.animation = ''), 500);
        return;
      }

      // proceed to create user
      isSubmitting = true;
      signupButtonText.innerHTML = '<span style="display:inline-block;width:18px;height:18px;border:3px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite;margin-right:8px"></span>Creating Account...';
      updateSignupButtonState();

      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        // send verification
        await user.sendEmailVerification();

        // store user data
        await db.collection('users').doc(user.uid).set({
          firstName,
          lastName,
          email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          emailVerified: false,
          accountType: 'free'
        });

        verificationEmail.textContent = email;
        verificationSection.style.display = 'block';
        showEmailStatus('Account created! Verification email sent to your inbox.', 'success');

        // reset form & reset reCAPTCHA
        signupForm.reset();
        isRecaptchaVerified = false;
        if (typeof grecaptcha !== 'undefined' && grecaptcha.reset) grecaptcha.reset();
        updateSignupButtonState();
      } catch (err) {
        console.error('Firebase error:', err);
        let msg = 'An error occurred. Please try again.';
        if (err && err.code) {
          switch (err.code) {
            case 'auth/email-already-in-use': msg = 'This email is already registered.'; break;
            case 'auth/invalid-email': msg = 'Please enter a valid email address.'; break;
            case 'auth/weak-password': msg = 'Password is too weak. Please use a stronger password.'; break;
            case 'auth/network-request-failed': msg = 'Network error. Please check your connection.'; break;
            case 'auth/operation-not-allowed': msg = 'Email/password accounts are not enabled. Please contact support.'; break;
            default: msg = err.message || msg;
          }
        } else if (err && err.message) msg = err.message;
        showEmailStatus(msg, 'error');
      } finally {
        isSubmitting = false;
        signupButtonText.textContent = 'Create Account';
        updateSignupButtonState();
      }
    });

    // Resend verification
    resendEmail.addEventListener('click', async function(e) {
      e.preventDefault();
      try {
        const user = auth.currentUser;
        if (user) {
          await user.sendEmailVerification();
          showEmailStatus('Verification email sent!', 'success');
        } else {
          showEmailStatus('Please sign in again to resend verification email.', 'error');
        }
      } catch (err) {
        console.error('Resend error:', err);
        showEmailStatus('Error sending verification email. Please try again.', 'error');
      }
    });

    // Google Sign-In (compat)
    const googleSignUp = document.getElementById('googleSignUp');
    googleSignUp.addEventListener('click', async function() {
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('email');
        provider.addScope('profile');
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        const userDoc = await db.collection('users').doc(user.uid).get();
        if (!userDoc.exists) {
          await db.collection('users').doc(user.uid).set({
            firstName: user.displayName ? user.displayName.split(' ')[0] : '',
            lastName: user.displayName ? user.displayName.split(' ').slice(1).join(' ') : '',
            email: user.email,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            emailVerified: user.emailVerified,
            googleSignIn: true,
            accountType: 'free'
          });
        }
        showEmailStatus('Signed in successfully with Google!', 'success');
        setTimeout(() => (window.location.href = 'dashboard.html'), 1200);
      } catch (err) {
        console.error('Google Sign-In error:', err);
        const msg = (err && err.message) ? err.message : 'Error signing in with Google.';
        showEmailStatus(msg, 'error');
      }
    });

    // Realtime small validation
    firstNameInput.addEventListener('input', () => { if (firstNameInput.value.trim().length >= 2) hideError(firstNameInput, firstNameError); });
    lastNameInput.addEventListener('input', () => { if (lastNameInput.value.trim().length >= 2) hideError(lastNameInput, lastNameError); });
    emailInput.addEventListener('input', () => { if (validateEmail(emailInput.value)) hideError(emailInput, emailError); });
    confirmPasswordInput.addEventListener('input', () => { if (confirmPasswordInput.value === passwordInput.value) hideError(confirmPasswordInput, confirmPasswordError); });
    termsCheckbox.addEventListener('change', () => { if (termsCheckbox.checked) termsError.style.display = 'none'; });

    // keyboard accessible: press Enter to try to submit

    // initial state
    updateSignupButtonState();

    // small spin keyframes for inline spinner
    const style = document.createElement('style');
    style.innerHTML = '@keyframes spin{to{transform:rotate(360deg)}}';
    document.head.appendChild(style);
  </script>
</body>
</html>
